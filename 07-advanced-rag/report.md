# üìò Advanced RAG Experiments

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π Retrieval-Augmented Generation (RAG) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ reranker-–º–æ–¥–µ–ª–µ–π.

## üß© –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫

### üî§ **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**

* `intfloat/multilingual-e5-base` (HuggingFace)
* –ó–∞–ø—É—Å–∫ –Ω–∞ **MPS** (Apple Silicon)

### ü§ñ **LLM**

* –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞: `gpt-4o`
* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞: `gpt-4o`

### üõ†Ô∏è **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞**

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —É—Ç–∏–ª–∏—Ç–∞ `evaluate_with_ragas`, –≤–∫–ª—é—á–∞—é—â–∞—è —Ç—Ä–∏ —à–∞–≥–∞:

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –º–æ–¥–µ–ª–∏
2. –ü–æ–¥—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ RAGAS
3. –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ LangSmith

–ú–µ—Ç—Ä–∏–∫–∏:

* **faithfulness**
* **answer_relevancy**
* **answer_correctness**
* **answer_similarity**
* **context_recall**
* **context_precision**

–í—Å–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –Ω–∞ **–æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –±–∞—Ç—á–µ –∏–∑ 6 –≤–æ–ø—Ä–æ—Å–æ–≤** –¥–∞—Ç–∞—Å–µ—Ç–∞ *06-monitoring-qa*.

---

# üìä –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

## 1. Semantic Retrieval (–±–∞–∑–æ–≤—ã–π)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ß–∏—Å—Ç–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

* –≠–º–±–µ–¥–¥–∏–Ω–≥–∏: `multilingual-e5-base`
* Query rewriting: `gpt-4o`
* –û—Ç–≤–µ—Ç: `gpt-4o`

–≠—Ç–æ ‚Äî baseline –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

![–í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∫–∞—Ä—Ç—ã](./screenshots/experiment-1-semantic-baseline.jpg)

---

## 2. Hybrid Retrieval (Semantic + BM25)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ BM25.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

* –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ `k=10`
* BM25 `k=10`
* –í–µ—Å–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: `0.5 / 0.5`
* –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ LLM –∫–∞–∫ –≤ baseline

**–¶–µ–ª—å:**

* –ü–æ–≤—ã—Å–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É –ø–æ–∏—Å–∫–∞
* –ó–∞—Ö–≤–∞—Ç–∏—Ç—å –∫–∞–∫ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, —Ç–∞–∫ –∏ —Ç–æ—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ

![–í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∫–∞—Ä—Ç—ã](./screenshots/experiment-2-hybrid.png)
---

## 3. Hybrid Retrieval + Cross-Encoder Reranker

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–Ω–∞—á–∞–ª–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è –≤—ã–¥–∞—á–∞, –∑–∞—Ç–µ–º reranking —á–µ—Ä–µ–∑ –º–æ—â–Ω—ã–π –∫—Ä–æ—Å—Å-—ç–Ω–∫–æ–¥–µ—Ä.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

* Semantic k = 10
* BM25 k = 10
* –í–µ—Å–∞ –ø–æ–∏—Å–∫–∞ = 0.5 / 0.5
* Reranker: `cross-encoder/mmarco-mMiniLMv2-L12-H384-v1`
* Top-k –ø–æ—Å–ª–µ reranker: **3**

**–ò–¥–µ—è:**
–£–±—Ä–∞—Ç—å –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –ø–æ–ª–Ω–æ—Ç—É –ø–æ–∏—Å–∫–∞ –∏ —É–ª—É—á—à–∏–≤ —Ç–æ—á–Ω–æ—Å—Ç—å.

![–í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –∫–∞—Ä—Ç—ã](./screenshots/experiment-3-hybrid-reranker.png)
---

# üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑

### üîç –û–±—â–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è

* –í—Å–µ —Ä–µ–∂–∏–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç **context_recall = 1.0**
  ‚Üí —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
* –†–∞–∑–ª–∏—á–∏—è –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è –≤:

  * faithfulness
  * answer_relevancy
  * context_precision
  * answer_correctness

---

## üìå –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

### üü¶ 1. Semantic Retrieval (baseline)

* –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
* –•–æ—Ä–æ—à–∏–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–π

### üüß 2. Hybrid Retrieval

* **–õ—É—á—à–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å *faithfulness*** —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
* –ù–æ **—Ö—É–∂–µ precision**, —á–µ–º –≤ reranker-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
* –ü–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –≤–∞–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Ä—É—á–Ω–æ–π –∞–Ω–∞–ª–∏–∑, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)

### üü© 3. Hybrid + Reranker (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

–î–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞:

* +0.09 –∫ **faithfulness** –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ baseline
* +0.13 –∫ **answer_relevancy**
* **context_precision = 0.97** ‚Üí –ø–æ—á—Ç–∏ –Ω–µ—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç **context_recall = 1.0**

–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º, –∫–æ—Ç–æ—Ä—ã–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç:

* –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å (faithfulness = 0.92)
* —Ç–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ (answer_correctness = 0.62)
* —á–∏—Å—Ç–æ—Ç—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

---

# üèÜ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úî –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: **Hybrid + Cross-Encoder Reranker**

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

* production RAG
* –∑–∞–¥–∞—á, –≥–¥–µ –≤–∞–∂–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
* —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### ‚ûï –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥ –±–µ–∑ reranker

* –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
* —Ä—É—á–Ω–∞—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
* –∑–∞–¥–∞—á–∏, –≥–¥–µ –≤–∞–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤

### ‚ûñ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∏—Å—Ç—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

* –±—ã—Å—Ç—Ä—ã–µ baseline-—Ç–µ—Å—Ç—ã
* –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
